<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="UTF-8">
    <title>Delibee - Delivery Tracking Library On Node.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Delibee, 국내 택배 배송 추적 라이브러리"/>
    <meta name="keywords" content="delivery, tracking, delibee, 택배, 배송, 추적"/>
    <link rel="stylesheet" type="text/css" href="./css/nprogress.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./css/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./css/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./css/common.css" media="screen">
    <script src="./js/axios.min.js"></script>
    <script src="./js/marked.min.js"></script>
    <script src="./js/nprogress.js"></script>
    <script src="./js/tmpl.min.js"></script>
</head>
<body>

<iframe class="github-star" src="https://ghbtns.com/github-btn.html?user=flosdor&repo=delibee&type=star&count=true"
        frameborder="0" scrolling="0" width="170px" height="20px"></iframe>

<section class="page-header">
    <h1 class="project-name">
        <img alt="Delibee" src="img/delibee.png" style="width: 200px;"/>
    </h1>
    <h2 class="project-tagline">Delibee는 국내 택배사들의 배송상황을 트래킹 할 수 있도록 만들어주는 Node.js 기반의 라이브러리입니다.</h2>
    <a href="https://github.com/moodselah/delibee" class="btn" target="_blank">View on GitHub</a>
</section>

<section class="main-content">
    <p>
        <a href="https://npmjs.org/package/delibee" target="_blank"><img src="https://img.shields.io/npm/v/delibee.svg" alt="NPM Version" style="max-width:100%;"></a>
        <a href="https://npmjs.org/package/delibee" target="_blank"><img src="https://img.shields.io/npm/dm/delibee.svg" alt="NPM Downloads" style="max-width:100%;"></a>
        <a href="https://travis-ci.org/moodselah/delibee" target="_blank"><img src="https://img.shields.io/travis/moodselah/delibee/master.svg" alt="Build Status" style="max-width:100%;"></a>
        <a href="https://coveralls.io/r/moodselah/delibee?branch=master" target="_blank"><img src="https://coveralls.io/repos/github/moodselah/delibee/badge.svg" alt="Test Coverage" style="max-width:100%;"></a>
    </p>
    <h2>Delibee API Test</h2>
    <p>
        <form onSubmit="tracking(); return false">
            <select id="delivery-company">
                <option value="">택배사 가져오는 중..</option>
            </select>
            <input id="invoice-number" type="text" value="" placeholder="송장번호 (- 제외)" onkeyup='removeChar(event)'>
            <button id="btn-tracking" class="btn btn-black" type="submit">Tracking</button>
        </form>
        <div id="delibee-info"></div>
    </p>

    <div id="markdown-content"></div>

    <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/moodselah/delibee">Delibee</a> is maintained by <a
                href="https://github.com/moodselah">moodselah</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a
                href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a
                href="https://twitter.com/jasonlong">Jason Long</a>.</span>
    </footer>

</section>

<script type="text/x-tmpl" id="delibee-company-template">
    {% for (var key in o) { %}
    <option value="{%=key%}">{%=o[key]%}</option>
    {% } %}
</script>

<script type="text/x-tmpl" id="delibee-info-template">
    <table>
        <thead>
        </thead>
        <tbody>
        <tr>
            <th>택배사</th>
            <td>{%=o.deliveryCompany.name%}</td>
            <th>송장번호</th>
            <td>{%=o.invoiceNumber%}</td>
        </tr>
        {% if (o.senderName && o.receiverName) { %}
        <tr>
            <th>보낸이</th>
            <td>{%=o.senderName%}</td>
            <th>받는이</th>
            <td>{%=o.receiverName%}</td>
        </tr>
        {% } %}
        <tr>
            <th>배송상태</th>
            <td colspan="3">{%=o.statusText%}</td>
        </tr>
        </tbody>
    </table>
    <br>
    <table>
        <thead>
        <tr>
            <th>처리일시</th>
            <th>위치</th>
            <th>배송상태 (Delibee 제공)</th>
            <th>배송상태 (택배사 제공)</th>
        </tr>
        </thead>
        <tbody>
        {% for (var i = 0; i < o.history.length; i += 1) { %}
        <tr>
            <td>{%=o.history[i].dateString%}</td>
            <td>{%=o.history[i].location%}</td>
            <td>{%=o.history[i].statusText%}</td>
            <td>{%=o.history[i].remark%}</td>
        </tr>
        {% } %}
        </tbody>
    </table>
</script>

<script>
  function removeChar(event) {
    event = event || window.event;
    var keyID = (event.which) ? event.which : event.keyCode;
    if (keyID == 8 || keyID == 46 || keyID == 37 || keyID == 39) {
      return;
    } else {
      event.target.value = event.target.value.replace(/[^0-9]/g, "");
    }
  }
  function tracking () {
    var deliveryCompany = document.getElementById('delivery-company');
    var invoiceNumber = document.getElementById('invoice-number');
    var btnTracking = document.getElementById('btn-tracking');
    if (invoiceNumber.disabled || btnTracking.disabled) {
      return;
    }
    deliveryCompany.disabled = invoiceNumber.disabled = btnTracking.disabled = true;
    NProgress.start();
    NProgress.inc();
    axios
      .get('https://delibee.moodselah.com/tracking', {
        params: {
          'company': deliveryCompany.value,
          'invoice_no': invoiceNumber.value
        }
      })
      .then(function (res) {
        NProgress.inc();
        var data = res.data;
        if (data.success && data.invoice) {
          document.getElementById('delibee-info').innerHTML = tmpl('delibee-info-template', data.invoice);
        } else {
          document.getElementById('delibee-info').innerHTML = '';
          data.message && alert(data.message);
        }
        deliveryCompany.disabled = invoiceNumber.disabled = btnTracking.disabled = false;
        NProgress.done();
      })
      .catch(function () {
        NProgress.done();
      });
  }
  function loadDeliveryCompanies () {
    NProgress.start();
    axios.get('https://delibee.moodselah.com/tracking/companies').then(function (res) {
      document.getElementById('delivery-company').innerHTML = tmpl('delibee-company-template', res.data);
      NProgress.done();
    })
    .catch(function () {
      NProgress.done();
    });
  }
  function loadReadme () {
    axios.get('./README.md').then(function (res) {
      document.getElementById('markdown-content').innerHTML = marked(res.data);
    });
  }
  loadReadme()
  loadDeliveryCompanies()
</script>

</body>
</html>
